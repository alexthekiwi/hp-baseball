{{#
    Displays the "Order Notes" step in the Checkout process.
#}}

{{ partial:checkout/components/step title="Order Notes" }}
    <div class="flex flex-col space-y-4" x-data="{
        bundleNotes: '',
        init() {
            // Get bundle configurations from localStorage
            const configs = JSON.parse(localStorage.getItem('bundleConfigurations') || '[]');
            
            if (configs.length > 0) {
                const notes = configs.map(config => {
                    const items = Object.entries(config.items)
                        .map(([item, size]) => `  - ${item}: ${size}`)
                        .join('\n');
                    return `${config.productTitle}:\n${items}`;
                }).join('\n\n');
                
                this.bundleNotes = `BUNDLE SIZE CONFIGURATIONS:\n\n${notes}\n\n`;
                
                // Set the value directly
                this.$nextTick(() => {
                    const textarea = document.getElementById('order_notes');
                    if (textarea && !textarea.value) {
                        textarea.value = this.bundleNotes;
                    }
                });
            }
        }
    }">
        <p class="text-sm text-gray-600">{{ "Add any special instructions for your order (optional)" | trans }}</p>
        
        <div>
            <label for="order_notes" class="block text-sm font-medium text-gray-700">{{ "Order Notes" | trans }}</label>
            <div class="mt-1">
                <textarea
                    id="order_notes"
                    name="order_notes"
                    rows="6"
                    placeholder="{{ 'e.g. for a bundle if you need a different size for a specific item, please provide details here.' | trans }}"
                    class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm"
                ></textarea>
            </div>
            
            <template x-if="errors.hasOwnProperty('order_notes')">
                <ul class="mt-1">
                    <template x-for="error in errors['order_notes']">
                        <li class="text-red-600 text-sm" x-text="error"></li>
                    </template>
                </ul>
            </template>
        </div>
    </div>

    {{ slot:footer }}
        {{ partial:checkout/components/button label="Continue â†’" type="submit" }}
    {{ /slot:footer }}
{{ /partial:checkout/components/step }}