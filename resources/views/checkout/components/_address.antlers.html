{{#
    @name Address
    @desc Renders address form fields.
    @param* type The type of address. Options: shipping, billing.
#}}

<div x-data="{{ type | ucfirst }}Address" class="flex flex-col space-y-6">
    <!-- Hidden country input defaulted to New Zealand -->
    <input type="hidden" name="{{ type }}_country" value="NZL" x-model="country">

    {{ partial:checkout/components/input
        name="{type}_line_1"
        label="Street Address"
        type="text"
        xBindValue="cart.{type}_name || cart.customer?.name"
        autocomplete="{type} address-line1"
        required="true"
    }}

    {{ partial:checkout/components/input
        name="{type}_line_2"
        label="Suburb"
        type="text"
        xBindValue="cart.{type}_line_2"
        autocomplete="{type} address-line2"
    }}

    <div class="grid sm:grid-cols-2 gap-6">
        {{ partial:checkout/components/input
            name="{type}_city"
            label="City"
            type="text"
            xBindValue="cart.{type}_city"
            autocomplete="{type} address-level1"
            required="true"
        }}

        {{ partial:checkout/components/input
            name="{type}_postcode"
            label="Postcode"
            type="text"
            xBindValue="cart.{type}_postcode"
            autocomplete="{type} postal-code"
            required="true"
        }}
    </div>

    {{# <template x-if="states.length">
        {{ partial:checkout/components/select name="{type}_state" label="Region" autocomplete="{type} address-level1" required="true" }}
            <option disabled value="">{{ 'Select a state' | trans }}</option>
            <template x-for="state in states" :key="state.code">
                <option :value="state.code" :selected="state.code === cart.{{ type }}_state?.code" x-text="state.name"></option>
            </template>
        {{ /partial:checkout/components/select }}
    </template> #}}
</div>

{{ push:footer_scripts }}
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('{{ type | ucfirst }}Address', () => ({
                country: 'NZL',
                states: [],

                init() {
                    this.country = this.cart.{{ type }}_country?.value || 'NZL';

                    if (this.country) this.fetchStates();

                    this.$watch('country', (value) => this.fetchStates());
                },

                fetchStates() {
                    this.states = [];

                    fetch(`{{ route:statamic.cargo.states }}?country=${this.country}`)
                        .then(response => response.json())
                        .then(data => this.states = data);
                },
            }));
        });
    </script>
{{ /push:footer_scripts }}
