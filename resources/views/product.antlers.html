{{ partial:main :hero_bg_type="'Colour'" :hero_bg_colour="'white'" }}
    {{ if product_variants }}
    <div x-data="productPage()"
          data-first-variant="{{ product_variants:options limit='1' }}{{ key }}{{ /product_variants:options }}"
          data-first-price="{{ product_variants:options limit='1' }}{{ price }}{{ /product_variants:options }}">
    {{ else }}
    <div x-data="productPage()"
          data-price="{{ price ?? 0 }}">
    {{ /if }}
        {{ partial:components/blocks/_hero
            :title="title"
            background_type="Colour"
            background_colour="primary"
            align="start"
            show_breadcrumbs="true"
        }}

        {{ partial:components/block
            padding_top="none"
            padding_bottom="base"
        }}

            <!-- Success Message -->
            <div x-show="showSuccessMessage" x-transition.opacity.duration.500ms
                 class="mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg"
                 x-init="setTimeout(() => showSuccessMessage = false, 5000)">
                Product added to cart successfully!
            </div>

            <!-- Already in Cart Message -->
            {{ if {cart:added product="{page:id}"} }}
                <div class="flex gap-6 items-start flex-col md:items-center md:flex-row md:justify-between p-6 bg-gray-light text-primary rounded-lg">
                    <span class="font-bold">This product is in your cart.</span>
                    {{ partial:components/common/button link="/cart" colour="primary" style="Solid" }}
                        Go to Cart
                    {{ /partial:components/common/button }}
                </div>
            {{ /if }}

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-4">
                    {{ partial:alpine/carousel }}
                </div>

                <div class="flex flex-col gap-6">
                    <!-- Details -->
                    <div class="space-y-4">
                        <h3 class="font-semibold">Details</h3>
                        <div class="text-base prose">
                            {{ content }}
                        </div>
                    </div>

                    <!-- Add to Cart Form -->
                    {{ cart:add class="space-y-6" @submit="handleAddToCart()" }}
                        <input type="hidden" name="product" value="{{ page:id }}">

                        <!-- Variant Selector -->
                        {{ if product_variants }}
                            <div>
                                <label class="block text-sm font-medium mb-3">Size</label>
                                <div class="grid grid-cols-3 md:grid-cols-4 gap-2">
                                    {{ product_variants:options }}
                                        <label class="relative">
                                            <input
                                                type="radio"
                                                name="variant"
                                                value="{{ key }}"
                                                x-model="selectedVariant"
                                                @change="updatePriceFromString('{{ price }}')"
                                                {{ if first }}checked{{ /if }}
                                                required
                                                class="sr-only peer"
                                            >
                                            <div class="text-center px-4 py-2 border border-gray-300 rounded-lg cursor-pointer hover:border-primary peer-checked:border-primary peer-checked:bg-primary peer-checked:text-white transition-all">
                                                {{ variant }}
                                            </div>
                                        </label>
                                    {{ /product_variants:options }}
                                </div>
                            </div>
                        {{ /if }}

                        <!-- Price Display -->
                        <div class="text-2xl font-bold text-primary">
                            {{ if product_variants }}
                                <div x-show="selectedPrice" x-text="'$' + (selectedPrice / 100).toFixed(2)"></div>
                            {{ else }}
                                {{ price }}
                            {{ /if }}
                        </div>

                        <!-- Quantity Selector -->
                        <div>
                            <label class="block text-sm font-medium mb-2">Quantity</label>
                            <input
                                type="number"
                                name="quantity"
                                min="1"
                                value="1"
                                required
                                class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                            >
                        </div>

                        <!-- Add to Cart Button -->
                        <button
                            type="submit"
                            :disabled="isSubmitting"
                            class="bg-primary px-8 py-3 text-white font-medium rounded-lg transition-colors hover:bg-primary-dark disabled:opacity-50">
                            <span x-text="isSubmitting ? 'Adding...' : 'Add to Cart'"></span>
                        </button>
                    {{ /cart:add }}
                </div>
            </div>
        {{ /partial:components/block }}
    </div>
{{ /partial:main }}
